{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es6.function.name.js","webpack:///./src/views/PublishDetail.vue?a1e2","webpack:///./src/views/PublishDetail.vue?3666","webpack:///src/views/PublishDetail.vue","webpack:///./src/views/PublishDetail.vue?e6ab","webpack:///./src/views/PublishDetail.vue?148b","webpack:///./src/views/PublishDetail.vue?65e8"],"names":[],"mappings":";;;;;AAAA,SAAS,mBAAO,CAAC,MAAc;AAC/B;AACA;AACA;;AAEA;AACA,kBAAkB,mBAAO,CAAC,MAAgB;AAC1C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,CAAC;;;;;;;;ACfD,uC;;;;;;;;;;;ACAA,0BAA0B,aAAa,0BAA0B,wBAAwB,2BAA2B,aAAa,qBAAqB,sBAAsB,OAAO,yCAAyC,qEAAqE,OAAO,MAAM,yBAAyB,iJAAiJ,aAAa,kFAAkF,oCAAoC,aAAa,gBAAgB,6EAA6E,aAAa,eAAe,4DAA4D,OAAO,wBAAwB,iEAAiE,IAAI,4BAA4B,QAAQ,mDAAmD,sBAAsB,6BAA6B,gCAAgC,OAAO,2BAA2B,aAAa,aAAa,oBAAoB,oCAAoC,aAAa,mBAAmB,QAAQ,iEAAiE,gBAAgB,OAAO,gBAAgB,gBAAgB,OAAO,oBAAoB,gBAAgB,OAAO,mBAAmB,gBAAgB,OAAO,kBAAkB,gBAAgB,OAAO,mBAAmB,gBAAgB,OAAO,oBAAoB,gBAAgB,OAAO,kBAAkB,uBAAuB,OAAO,2BAA2B,aAAa,aAAa,oBAAoB,+BAA+B,oCAAoC,iBAAiB,qBAAqB,gCAAgC,iBAAiB,YAAY,2EAA2E,mCAAmC,KAAK,0BAA0B,mCAAmC,qBAAqB,OAAO,kCAAkC,YAAY,aAAa,EAAE,wKAAwK,QAAQ,oBAAoB;AACrwE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC0DA;AACA;AACA;AACA;AACA,MADA,kBACA;AACA;AACA,oBADA;AAEA,yBAFA;AAGA,mBAHA;AAIA;AACA,yBADA;AAEA,oBAFA;AAGA;AAHA,OAJA;AASA,gBATA;AAUA;AACA,iBADA;AAEA,iBAFA;AAGA,iBAHA;AAIA,iBAJA;AAKA,iBALA;AAMA,iBANA;AAOA,iBAPA;AAQA;AARA,OAVA;AAoBA;AACA,wBADA;AAEA;AAFA;AApBA;AAyBA,GA3BA;AA4BA;AACA,gBADA,wBACA,WADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA,KAVA;AAWA,aAXA,qBAWA,UAXA,EAWA;AACA;AACA;;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA,KArBA;AAsBA,gBAtBA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAuBA,oBAvBA;AAAA;AAAA;AAAA;;AAwBA;AACA,qCADA;AAEA;AAFA;AAxBA;;AAAA;AAAA;AAAA,uBA+BA,wBACA,IADA,CACA,UADA,EACA;AAAA;AAAA,iBADA,EAEA,IAFA,CAEA;AACA;AACA;AACA,qCADA;AAEA;AAFA;;AAIA;AACA;AACA;AACA;AADA;AAGA,qBAJA,EAIA,IAJA;AAKA;AACA;;AACA;AACA,mCADA;AAEA,sCAFA;AAGA;AAHA;AAKA,iBArBA,EAsBA,KAtBA,CAsBA;AACA;AACA,iBAxBA,EAyBA,IAzBA,CAyBA,cAzBA,CA/BA;;AAAA;AA0DA,sBA1DA,GA0DA,wCA1DA;AA2DA;AAEA;AACA;AAAA;AAAA;AACA,iBAFA;AAIA,gDACA,4BADA,GAEA,GAFA,GAGA,oBAHA,EAIA;AACA;AACA;AACA,2CADA;AAEA;AAFA;AAIA;;AACA;AACA;;AACA;;AACA;AACA;AACA;;AACA;AACA;;AACA;AACA;;AACA;AACA,mCADA;AAEA,iCACA,GADA,EAEA;AAAA;AAAA,uBAFA,EAGA,2CAHA,CAFA;AAOA;AAPA;AASA;;AACA;AACA;;AACA;AACA,mCADA;AAEA,kCACA,GADA,EAEA;AAAA;AAAA,uBAFA,EAGA,2CAHA,CAFA;AAOA;AAPA;AASA;AACA,iBA3CA;;AAjEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA+GA,kBA/GA,0BA+GA,aA/GA,EA+GA;AAAA;;AACA;AACA;AACA;;AACA,sCAJA,CAKA;;AACA;AACA;AACA,OARA,CASA;;;AACA,UACA,0CACA,gCAFA,EAGA;AACA;AACA;AACA,4CAFA,CAEA;AACA,SAHA;AAIA,OARA,MAQA;AACA;AACA;AACA;AACA,KArIA;AAsIA,cAtIA,wBAsIA;AACA;AACA,oFACA,WADA,GAEA,CAFA;AAGA,sFACA,EADA;AAEA;AA7IA,GA5BA;AA2KA,SA3KA,qBA2KA;AACA;AACA;AACA,sCAHA,CAIA;;AACA,sEACA,sBADA;AAEA,gFACA,OADA;AAEA,GApLA;AAqLA,SArLA,qBAqLA;AACA;AACA;AAvLA,G;;AC9DuU,CAAgB,qHAAG,EAAC,C;;;;;;;;ACAnP;AACvC;AACL;AACqC;;;AAGjG;AAC0F;AAC1F,gBAAgB,8CAAU;AAC1B,EAAE,2CAAM;AACR,EAAE,MAAM;AACR,EAAE,eAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,oG;;;;;;;;ACnBf;AAAA;AAAA;AAAyd,CAAgB,ugBAAG,EAAC,C","file":"js/chunk-5d46a730.c6d3971a.js","sourcesContent":["var dP = require('./_object-dp').f;\nvar FProto = Function.prototype;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// 19.2.4.2 name\nNAME in FProto || require('./_descriptors') && dP(FProto, NAME, {\n  configurable: true,\n  get: function () {\n    try {\n      return ('' + this).match(nameRE)[1];\n    } catch (e) {\n      return '';\n    }\n  }\n});\n","// extracted by mini-css-extract-plugin","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticStyle:{\"margin-top\":\"10px\"}},[_c('el-breadcrumb',{attrs:{\"separator-class\":\"el-icon-arrow-right\"}},[_c('el-breadcrumb-item',[_vm._v(\"后端发布\")]),_c('el-breadcrumb-item',{attrs:{\"to\":{ path: '/publishList' }}},[_vm._v(\"发布列表\")]),_c('el-breadcrumb-item',[_vm._v(\"发布详情\")]),_c('el-breadcrumb-item',[_vm._v(_vm._s(this.$route.query.name))])],1)],1),_c('div',{staticStyle:{\"margin-top\":\"5px\",\"text-align\":\"right\",\"font-size\":\"12px\",\"margin-right\":\"15px\"}},[(_vm.socket.connected)?_c('span',{staticStyle:{\"color\":\"blue\"}},[_vm._v(\"Socket connected\")]):_vm._e(),(_vm.socket.disconnected)?_c('span',{staticStyle:{\"color\":\"red\"}},[_vm._v(\"Socket disconnected\")]):_vm._e(),_c('el-divider',{attrs:{\"direction\":\"vertical\"}}),_vm._v(\"自动滚动日志：\\n    \"),(_vm.socket.connected)?_c('el-switch',{on:{\"change\":_vm.scroll_publish},model:{value:(_vm.scroll_switch),callback:function ($$v) {_vm.scroll_switch=$$v},expression:\"scroll_switch\"}}):_vm._e()],1),_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_c('span',{staticStyle:{\"font-size\":\"12px\"}},[_vm._v(\"发布进度\")])]),_c('el-steps',{staticStyle:{\"font-size\":\"12px\"},attrs:{\"active\":_vm.active,\"finish-status\":\"success\",\"align-center\":\"\"}},[_c('el-step',{attrs:{\"title\":\"准备环境\"}}),_c('el-step',{attrs:{\"title\":\"从git克隆工程\"}}),_c('el-step',{attrs:{\"title\":\"maven打包\"}}),_c('el-step',{attrs:{\"title\":\"检查上传环境\"}}),_c('el-step',{attrs:{\"title\":\"上传远程服务器\"}}),_c('el-step',{attrs:{\"title\":\"执行远程发布脚本\"}}),_c('el-step',{attrs:{\"title\":\"发布收尾工作\"}})],1),_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_c('span',{staticStyle:{\"font-size\":\"12px\"}},[_vm._v(\"发布日志\")])]),_c('div',{staticClass:\"publish_detail\",attrs:{\"id\":\"terminal\"}},[_c('el-scrollbar',{ref:\"el_scrollbar\",staticStyle:{\"height\":\"100%\"}},[_c('div',{ref:\"log_output\",staticClass:\"publish\",style:(_vm.publish_style),domProps:{\"innerHTML\":_vm._s(_vm.log_output)},on:{\"scroll\":function($event){return _vm.scroll_publish(false)}}})]),_c('el-backtop',{attrs:{\"target\":\".publish\",\"bottom\":100}},[_c('div',{staticStyle:{\"{\\n      height\":\"100%\",\"width\":\"100%\",\"background-color\":\"#f2f5f6\",\"box-shadow\":\"0 0 6px rgba(0,0,0, .12)\",\"text-align\":\"center\",\"line-height\":\"25px\",\"color\":\"#1989fa\"},attrs:{\"id\":\"publish_div\"}},[_vm._v(\"UP\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <div style=\"margin-top: 10px;\">\n      <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n        <el-breadcrumb-item>后端发布</el-breadcrumb-item>\n        <el-breadcrumb-item :to=\"{ path: '/publishList' }\">发布列表</el-breadcrumb-item>\n        <el-breadcrumb-item>发布详情</el-breadcrumb-item>\n        <el-breadcrumb-item>{{ this.$route.query.name }}</el-breadcrumb-item>\n      </el-breadcrumb>\n    </div>\n    <div style=\"margin-top: 5px; text-align: right; font-size: 12px; margin-right: 15px;\">\n      <span v-if=\"socket.connected\" style=\"color: blue;\">Socket connected</span>\n      <span v-if=\"socket.disconnected\" style=\"color: red;\">Socket disconnected</span>\n      <el-divider direction=\"vertical\"></el-divider>自动滚动日志：\n      <el-switch v-if=\"socket.connected\" v-model=\"scroll_switch\" @change=\"scroll_publish\"></el-switch>\n    </div>\n    <el-divider content-position=\"left\">\n      <span style=\"font-size: 12px;\">发布进度</span>\n    </el-divider>\n    <el-steps :active=\"active\" finish-status=\"success\" align-center style=\"font-size: 12px;\">\n      <el-step title=\"准备环境\"></el-step>\n      <el-step title=\"从git克隆工程\"></el-step>\n      <el-step title=\"maven打包\"></el-step>\n      <el-step title=\"检查上传环境\"></el-step>\n      <el-step title=\"上传远程服务器\"></el-step>\n      <el-step title=\"执行远程发布脚本\"></el-step>\n      <el-step title=\"发布收尾工作\"></el-step>\n    </el-steps>\n    <el-divider content-position=\"left\">\n      <span style=\"font-size: 12px;\">发布日志</span>\n    </el-divider>\n    <div class=\"publish_detail\" id=\"terminal\">\n      <el-scrollbar style=\"height: 100%;\" ref=\"el_scrollbar\">\n        <div\n          class=\"publish\"\n          ref=\"log_output\"\n          v-html=\"log_output\"\n          @scroll=\"scroll_publish(false)\"\n          :style=\"publish_style\"\n        ></div>\n      </el-scrollbar>\n      <el-backtop target=\".publish\" :bottom=\"100\">\n        <div\n          id=\"publish_div\"\n          style=\"{\n        height: 100%;\n        width: 100%;\n        background-color: #f2f5f6;\n        box-shadow: 0 0 6px rgba(0,0,0, .12);\n        text-align: center;\n        line-height: 25px;\n        color: #1989fa;\n      }\"\n        >UP</div>\n      </el-backtop>\n    </div>\n  </div>\n</template>\n<script>\nimport http from \"../util/http.js\";\nimport { stringify } from \"querystring\";\nimport io from \"socket.io-client\";\nexport default {\n  data() {\n    return {\n      log_output: \"\",\n      scroll_switch: true,\n      scroll_top: 0,\n      publish_style: {\n        overflowY: \"auto\",\n        width: \"99%\",\n        height: \"550px\"\n      },\n      active: -1,\n      steps: {\n        $step0: 0,\n        $step1: 1,\n        $step2: 2,\n        $step3: 3,\n        $step4: 4,\n        $step5: 5,\n        $step6: 6,\n        $step7: 7\n      },\n      socket: {\n        connected: false,\n        disconnected: true\n      }\n    };\n  },\n  methods: {\n    getStepIndex(lineContent) {\n      if (lineContent != null && lineContent.indexOf(\"$step\") != -1) {\n        for (var key in this.steps) {\n          if (lineContent.indexOf(key) != -1) {\n            return this.steps[key];\n          }\n        }\n      }\n      return null;\n    },\n    getCookie(cookieName) {\n      var strCookie = document.cookie;\n      var arrCookie = strCookie.split(\"; \");\n      for (var i = 0; i < arrCookie.length; i++) {\n        var arr = arrCookie[i].split(\"=\");\n        if (cookieName == arr[0]) {\n          return arr[1];\n        }\n      }\n      return \"\";\n    },\n    async publish_init() {\n      if (!this.$route.query.id) {\n        this.$message({\n          message: \"发布ID不可为空\",\n          type: \"warning\"\n        });\n        return;\n      }\n\n      await http\n        .post(\"/publish\", { id: this.$route.query.id })\n        .then(response => {\n          if (response.data.status == \"FAILED\") {\n            this.$message({\n              message: \"请先登录\",\n              type: \"warning\"\n            });\n            let _this = this;\n            setTimeout(function() {\n              _this.$router.push({\n                path: \"/userLogin\"\n              });\n            }, 1000);\n            return;\n          }\n          this.$message({\n            showClose: true,\n            message: \"开始发布...\",\n            type: \"success\"\n          });\n        })\n        .catch(error => {\n          console.error(error);\n        })\n        .then(() => {});\n\n      const socket = io(process.env.VUE_APP_DOMAIN_BASE_URL);\n      this.socket = socket;\n      \n      socket.on(\"connect\", () => {\n        socket.emit(\"publish_event\", { id: this.$route.query.id });\n      });\n\n      socket.on(\"publish_response_\" +\n          this.getCookie(\"session_id\") +\n          \"_\" +\n          this.$route.query.id,\n        data => {\n          if (data.message) {\n            this.$message({\n              message: data.message,\n              type: \"warning\"\n            });\n          }\n          if (data.data) {\n            this.log_output += data.data + \"<br/>\";\n            var stepIndex = this.getStepIndex(data.data);\n            if (stepIndex != null) {\n              this.active = stepIndex;\n            }\n            this.scroll_publish(null);\n          }\n          if (data.status && data.status == \"OK\") {\n            const h = this.$createElement;\n            this.$notify({\n              title: \"发布状态\",\n              message: h(\n                \"i\",\n                { style: \"color: green\" },\n                this.$route.query.name + \"发布成功，详情请查看发布日志\"\n              ),\n              duration: 0\n            });\n          }\n          if (data.status && data.status == \"FAILED\") {\n            const h = this.$createElement;\n            this.$notify({\n              title: \"发布状态\",\n              message: h(\n                \"i\",\n                { style: \"color: grey\" },\n                this.$route.query.name + \"发布失败，详情请查看发布日志\"\n              ),\n              duration: 0\n            });\n          }\n        }\n      );\n    },\n    scroll_publish(manual_switch) {\n      if (!this.scroll_switch) {\n        return;\n      }\n      var div = this.$refs.log_output;\n      // socket调用时，加载时机的问题处理\n      if (!div) {\n        return;\n      }\n      // 如果人为打开开关，则自动滚动\n      if (\n        (manual_switch != null && manual_switch) ||\n        div.scrollTop >= this.scroll_top\n      ) {\n        this.$nextTick(() => {\n          div.scrollTop = div.scrollHeight;\n          this.scroll_top = div.scrollTop; // 标记当前滚动的位置，为下次识别是否人为滚动做准备\n        });\n      } else {\n        // 如果人为向上滚动，则停止自动滚动\n        this.scroll_switch = false;\n      }\n    },\n    resize_div() {\n      var height_used = this.$refs.log_output.getBoundingClientRect().top;\n      this.publish_style.height = `${document.documentElement.clientHeight -\n        height_used -\n        1}px`;\n      this.publish_style.width = `${document.documentElement.clientWidth * 1 -\n        38}px`;\n    }\n  },\n  mounted() {\n    // 自适应窗口\n    this.resize_div();\n    window.onresize = this.resize_div;\n    // js修改样式\n    document.getElementsByClassName(\"el-scrollbar__view\")[0].style +=\n      \";overflow-x: hidden;\";\n    document.getElementsByClassName(\"el-divider--horizontal\")[0].style.margin =\n      \"8px 0\";\n  },\n  created() {\n    this.publish_init();\n  }\n};\n</script>\n<style scoped>\n.publish_detail {\n  overflow-x: hidden;\n}\n.publish {\n  text-align: left;\n  border: 1px solid lightgray;\n}\n.el-step__title {\n  font-size: 12px;\n  line-height: 18px;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetail.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PublishDetail.vue?vue&type=template&id=2f682086&scoped=true&\"\nimport script from \"./PublishDetail.vue?vue&type=script&lang=js&\"\nexport * from \"./PublishDetail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PublishDetail.vue?vue&type=style&index=0&id=2f682086&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2f682086\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetail.vue?vue&type=style&index=0&id=2f682086&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetail.vue?vue&type=style&index=0&id=2f682086&scoped=true&lang=css&\""],"sourceRoot":""}