{"version":3,"sources":["webpack:///./src/views/PublishDetailFe.vue?f12a","webpack:///./src/views/PublishDetailFe.vue?3212","webpack:///./src/views/PublishDetailFe.vue?ffcb","webpack:///src/views/PublishDetailFe.vue","webpack:///./src/views/PublishDetailFe.vue?f26e","webpack:///./src/views/PublishDetailFe.vue?c3d3"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAAA;AAA2d,CAAgB,ygBAAG,EAAC,C;;;;;;;ACA/e,uC;;;;;;;;;;;ACAA,0BAA0B,aAAa,0BAA0B,wBAAwB,4KAA4K,wCAAwC,eAAe,mBAAmB,OAAO,wBAAwB,yEAAyE,OAAO,wBAAwB,kBAAkB,OAAO,0CAA0C,KAAK,4BAA4B,QAAQ,mDAAmD,sBAAsB,6BAA6B,uBAAuB,aAAa,kBAAkB,QAAQ,2BAA2B,gCAAgC,6BAA6B,qBAAqB,gCAAgC,iBAAiB,YAAY,2EAA2E,mCAAmC,KAAK,0BAA0B,mCAAmC,qBAAqB,OAAO,kCAAkC,YAAY,aAAa,EAAE,wKAAwK,QAAQ,oBAAoB;AAC71C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6CA;AACA;AACA;AACA,MADA,kBACA;AACA;AACA,oBADA;AAEA,yBAFA;AAGA,mBAHA;AAIA;AACA,yBADA;AAEA,uBAFA;AAGA;AAHA;AAJA;AAUA,GAZA;AAaA;AACA,WADA,qBACA;AACA;AACA;AAHA,GAbA;AAkBA;AACA,aADA,qBACA,UADA,EACA;AACA;AACA;;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA,KAXA;AAYA,gBAZA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAaA,oBAbA;AAAA;AAAA;AAAA;;AAcA;AACA,qCADA;AAEA;AAFA;AAdA;;AAAA;AAoBA;AACA;AACA,yBAtBA,GAsBA,IAtBA,EAsBA;;AAtBA;AAAA,uBAuBA,wBACA,IADA,CACA,YADA,EACA;AAAA;AAAA,iBADA,EAEA,IAFA,CAEA;AACA;AACA,mCADA;AAEA,sCAFA;AAGA;AAHA;;AAKA;AACA;AACA;AACA;AACA,iBAZA,EAaA,KAbA,CAaA;AACA;AACA,iBAfA,EAgBA,IAhBA,CAgBA,cAhBA,CAvBA;;AAAA;AAyCA;AACA,0CADA;AAEA;AAFA;AAIA,wCACA,yBACA,mCADA,GAEA,GAFA,GAGA,oBAJA,EAKA;AACA;AACA;AACA,2CADA;AAEA;AAFA;AAIA;;AACA;AACA;;AACA;AACA;;AACA;AACA;;AACA;AACA,mCADA;AAEA,iCACA,GADA,EAEA;AAAA;AAAA,uBAFA,EAGA,+BAHA,CAFA;AAOA;AAPA;AASA;AACA,iBA5BA;;AA7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AA4EA,kBA5EA,0BA4EA,aA5EA,EA4EA;AAAA;;AACA;AACA;AACA;;AACA,sCAJA,CAKA;;AACA;AACA;AACA,OARA,CASA;AACA;;;AACA,UACA,0CACA,gCAFA,EAGA;AACA;AACA;AACA,4CAFA,CAEA;AACA,SAHA;AAIA,OARA,MAQA;AACA;AACA;AACA;AACA,KAnGA;AAoGA,cApGA,wBAoGA;AACA;AACA;AACA,oFACA,WADA,GAEA,CAFA;AAGA,kFACA,IADA;AAEA;AA5GA,GAlBA;AAgIA,SAhIA,qBAgIA;AACA;AACA;AAEA;AACA;AACA,sCANA,CAOA;;AACA,sEACA,sBADA;AAEA,gFACA,OADA;AAEA,GA5IA;AA6IA,SA7IA,qBA6IA;AACA;AACA;AA/IA,G;;AChDyU,CAAgB,yHAAG,EAAC,C;;;;;;;;ACAnP;AACvC;AACL;AACqC;;;AAGnG;AAC0F;AAC1F,gBAAgB,8CAAU;AAC1B,EAAE,6CAAM;AACR,EAAE,MAAM;AACR,EAAE,eAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEe,sG","file":"js/chunk-7bc86ee7.d7650424.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetailFe.vue?vue&type=style&index=0&id=2b6ab1c2&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetailFe.vue?vue&type=style&index=0&id=2b6ab1c2&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',[_c('span',[_vm._v(_vm._s(_vm.$socket.connected ? 'Socket connected' : 'Socket disconnected'))]),_c('span',[(_vm.$socket.disconnected)?_c('span',{staticClass:\"notification\",staticStyle:{\"color\":\"red\"}},[_c('el-divider',{attrs:{\"direction\":\"vertical\"}}),_vm._v(\"You are disconnected\\n      \")],1):_vm._e()]),_c('el-divider',{attrs:{\"direction\":\"vertical\"}}),_c('el-switch',{attrs:{\"active-text\":\"自动滚动\",\"inactive-text\":\"取消\"},on:{\"change\":_vm.scroll_publish},model:{value:(_vm.scroll_switch),callback:function ($$v) {_vm.scroll_switch=$$v},expression:\"scroll_switch\"}})],1),_c('el-divider',{staticStyle:{\"margin\":\"10px 0\"},attrs:{\"content-position\":\"left\"}},[_vm._v(\"发布日志如下：\")]),_c('div',{staticClass:\"publish_detail\"},[_c('el-scrollbar',{ref:\"el_scrollbar\",staticStyle:{\"height\":\"100%\"}},[_c('div',{ref:\"log_output\",staticClass:\"publish\",style:(_vm.publish_style),domProps:{\"innerHTML\":_vm._s(_vm.log_output)},on:{\"scroll\":function($event){return _vm.scroll_publish(false)}}})]),_c('el-backtop',{attrs:{\"target\":\".publish\",\"bottom\":100}},[_c('div',{staticStyle:{\"{\\n      height\":\"100%\",\"width\":\"100%\",\"background-color\":\"#f2f5f6\",\"box-shadow\":\"0 0 6px rgba(0,0,0, .12)\",\"text-align\":\"center\",\"line-height\":\"25px\",\"color\":\"#1989fa\"},attrs:{\"id\":\"publish_div\"}},[_vm._v(\"UP\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <div>\n      <span>{{ $socket.connected ? 'Socket connected' : 'Socket disconnected' }}</span>\n      <span>\n        <span class=\"notification\" v-if=\"$socket.disconnected\" style=\"color: red;\">\n          <el-divider direction=\"vertical\"></el-divider>You are disconnected\n        </span>\n      </span>\n      <el-divider direction=\"vertical\"></el-divider>\n      <el-switch\n        v-model=\"scroll_switch\"\n        active-text=\"自动滚动\"\n        inactive-text=\"取消\"\n        @change=\"scroll_publish\"\n      ></el-switch>\n    </div>\n    <el-divider style=\"margin:10px 0;\" content-position=\"left\">发布日志如下：</el-divider>\n    <div class=\"publish_detail\">\n      <el-scrollbar style=\"height: 100%;\" ref=\"el_scrollbar\">\n        <div\n          class=\"publish\"\n          ref=\"log_output\"\n          v-html=\"log_output\"\n          @scroll=\"scroll_publish(false)\"\n          :style=\"publish_style\"\n        ></div>\n      </el-scrollbar>\n      <el-backtop target=\".publish\" :bottom=\"100\">\n        <div\n          id=\"publish_div\"\n          style=\"{\n        height: 100%;\n        width: 100%;\n        background-color: #f2f5f6;\n        box-shadow: 0 0 6px rgba(0,0,0, .12);\n        text-align: center;\n        line-height: 25px;\n        color: #1989fa;\n      }\"\n        >UP</div>\n      </el-backtop>\n    </div>\n  </div>\n</template>\n<script>\nimport http from \"../util/http.js\";\nimport { stringify } from \"querystring\";\nexport default {\n  data() {\n    return {\n      log_output: \"\",\n      scroll_switch: true,\n      scroll_top: 0,\n      publish_style: {\n        overflowY: \"auto\",\n        width: \"1300px\",\n        height: \"550px\"\n      }\n    };\n  },\n  sockets: {\n    connect() {\n      console.log(\"socket connected\");\n    }\n  },\n  methods: {\n    getCookie(cookieName) {\n      var strCookie = document.cookie;\n      var arrCookie = strCookie.split(\"; \");\n      for (var i = 0; i < arrCookie.length; i++) {\n        var arr = arrCookie[i].split(\"=\");\n        if (cookieName == arr[0]) {\n          return arr[1];\n        }\n      }\n      return \"\";\n    },\n    async publish_init() {\n      if (!this.$route.query.id) {\n        this.$message({\n          message: \"发布ID不可为空\",\n          type: \"warning\"\n        });\n        return;\n      }\n      // 当首次cookie为空时，写完cookie后重连websocket（其他改进策略：换原生websocket，更好的掌控整个websocket生命周期）\n      // 终极改进：TODO 用户登录后，直接用会话的cookie标识\n      var reconnect = true;//this.getCookie(\"publish_client_id\") == \"\";\n      await http\n        .post(\"/publishFe\", { id: this.$route.query.id })\n        .then(response => {\n          this.$message({\n            showClose: true,\n            message: \"正在发布...\",\n            type: \"success\"\n          });\n          if (reconnect) {\n            // this.$socket.client.disconnect();\n            this.$socket.client.connect();\n          }\n        })\n        .catch(error => {\n          console.error(error);\n        })\n        .then(() => {});\n\n      this.$socket.client.emit(\"publish_event\", {\n        id: this.$route.query.id,\n        type: \"fe\"\n      });\n      this.$socket.$subscribe(\n        \"publish_response_fe_\" +\n          this.getCookie(\"publish_client_id\") +\n          \"_\" +\n          this.$route.query.id,\n        data => {\n          if (data.message) {\n            this.$message({\n              message: data.message,\n              type: \"warning\"\n            });\n          }\n          if (data.data && this.$refs.log_output) {\n            this.$refs.log_output.innerText += data.data;\n            this.scroll_publish(null);\n          }\n          if (data.status && data.status == \"OK\") {\n            const h = this.$createElement;\n            this.$notify({\n              title: \"发布状态\",\n              message: h(\n                \"i\",\n                { style: \"color: green\" },\n                data.project + \"发布结束，详情请查看发布日志\"\n              ),\n              duration: 0\n            });\n          }\n        }\n      );\n    },\n    scroll_publish(manual_switch) {\n      if (!this.scroll_switch) {\n        return;\n      }\n      var div = this.$refs.log_output;\n      // socket调用时，加载时机的问题处理\n      if (!div) {\n        return;\n      }\n      // console.log(\"=====\" + this.scroll_switch + \", \" + manual_switch + \", \" + div.scrollTop + \", \" + div.scrollHeight);\n      // 如果人为打开开关，则自动滚动\n      if (\n        (manual_switch != null && manual_switch) ||\n        div.scrollTop >= this.scroll_top\n      ) {\n        this.$nextTick(() => {\n          div.scrollTop = div.scrollHeight;\n          this.scroll_top = div.scrollTop; // 标记当前滚动的位置，为下次识别是否人为滚动做准备\n        });\n      } else {\n        // 如果人为向上滚动，则停止自动滚动\n        this.scroll_switch = false;\n      }\n    },\n    resize_div() {\n      // console.log('================' + document.documentElement.clientHeight + ', ' + document.documentElement.clientWidth);\n      var height_used = this.$refs.log_output.getBoundingClientRect().top;\n      this.publish_style.height = `${document.documentElement.clientHeight -\n        height_used -\n        1}px`;\n      this.publish_style.width = `${document.documentElement.clientWidth *\n        0.95}px`;\n    }\n  },\n  mounted() {\n    // document.getElementById(\"fe_vue\").className =\n    //   document.getElementById(\"fe_vue\").className + \" el-menu-item is-active\";\n\n    // 自适应窗口\n    this.resize_div();\n    window.onresize = this.resize_div;\n    // js修改样式\n    document.getElementsByClassName(\"el-scrollbar__view\")[0].style +=\n      \";overflow-x: hidden;\";\n    document.getElementsByClassName(\"el-divider--horizontal\")[0].style.margin =\n      \"8px 0\";\n  },\n  created() {\n    this.publish_init();\n  }\n};\n</script>\n<style scoped>\n.publish_detail {\n  overflow-x: hidden;\n}\n.publish {\n  text-align: left;\n  border: 1px solid lightgray;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetailFe.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublishDetailFe.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PublishDetailFe.vue?vue&type=template&id=2b6ab1c2&scoped=true&\"\nimport script from \"./PublishDetailFe.vue?vue&type=script&lang=js&\"\nexport * from \"./PublishDetailFe.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PublishDetailFe.vue?vue&type=style&index=0&id=2b6ab1c2&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2b6ab1c2\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}